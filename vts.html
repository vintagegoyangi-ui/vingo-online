<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Roguelike Card Game - Advanced Boss Logic</title>
    <style>
        :root { --í˜ëª…ë‹¨: #ff4d4d; --ê¸°ë§Œ: #a335ee; --ì‹­ë‹¤êµ¬: #0070dd; --ë…¸ë©€: #44bd32; }
        body { background: #05050a; color: white; margin: 0; height: 100vh; font-family: sans-serif; overflow: hidden; touch-action: none; }
        #battle-field { height: 65vh; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        /* ë³´ìŠ¤ ë ˆì´ì•„ì›ƒ */
        #boss-ui { text-align: center; z-index: 5; }
        #boss-sprite { width: 140px; height: 180px; background: #222; border: 3px solid #fff; border-radius: 15px; transition: 0.1s; position: relative; }
        #boss-intent { background: rgba(0,0,0,0.7); padding: 5px 12px; border-radius: 10px; color: gold; font-weight: bold; margin-bottom: 10px; min-height: 24px; border: 1px solid gold; }
        .hp-bar { width: 220px; height: 15px; background: #333; border-radius: 8px; overflow: hidden; margin-top: 10px; border: 1px solid #555; }
        .hp-fill { height: 100%; transition: width 0.3s; }

        /* í”Œë ˆì´ì–´ ìƒíƒœ */
        #player-ui { position: absolute; top: 20px; left: 20px; text-align: left; }
        #energy-ui { font-size: 1.5rem; color: #00d2ff; font-weight: bold; margin-top: 5px; }

        /* ì¹´ë“œ í•¸ë“œ */
        #hand-wrapper { height: 35vh; display: flex; align-items: center; padding: 0 20px; background: rgba(0,0,0,0.9); border-top: 2px solid #333; overflow-x: auto; white-space: nowrap; }
        .card { 
            width: 110px; height: 160px; margin-right: 10px; border-radius: 10px; border: 3px solid #fff;
            position: relative; background-color: #1a1a1a; flex-shrink: 0; transition: transform 0.1s;
        }
        .card-cost { position: absolute; top: -10px; left: -10px; width: 28px; height: 28px; background: #007bff; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold; border: 2px solid #fff; }
        .card-desc { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.8); padding: 5px; font-size: 10px; border-radius: 0 0 7px 7px; white-space: normal; }

        .throwing { transition: 0.4s ease-in !important; transform: translateY(-800px) scale(0) rotate(15deg) !important; opacity: 0; }
        #log { position: absolute; top: 30%; font-size: 1.2rem; font-weight: bold; color: #fff176; text-align: center; width: 100%; pointer-events: none; opacity: 0; }
    </style>
</head>
<body>

<div id="battle-field">
    <div id="player-ui">
        <div id="stage-info" style="font-size: 12px; color:#aaa;">NODE: 1</div>
        <div style="font-weight:bold;">PLAYER HP</div>
        <div class="hp-bar" style="width: 150px;"><div id="p-hp-fill" class="hp-fill" style="background: #2ecc71; width: 100%;"></div></div>
        <div id="energy-ui">âš¡ 3 / 3</div>
    </div>

    <div id="log"></div>

    <div id="boss-ui">
        <div id="boss-intent">ì¤€ë¹„ ì¤‘...</div>
        <div id="boss-sprite"></div>
        <div id="boss-attr" style="margin-top:5px; font-weight:bold;"></div>
        <div class="hp-bar"><div id="e-hp-fill" class="hp-fill" style="background: #ff4d4d; width: 100%;"></div></div>
        <div id="boss-status" style="font-size: 11px; margin-top:5px; color:#aaa;"></div>
    </div>
</div>

<div id="hand-wrapper"></div>

<script>
    // 1. ë³´ìŠ¤ ë°ì´í„° (30ì¢… í™•ì¥ì´ ìš©ì´í•œ êµ¬ì¡°)
    const BOSS_POOL = [
        { name: "ë¬´í•œë°©ì–´ë³‘", hp: 100, attr: "ë…¸ë©€", 
          ai: (b) => { b.defending = true; return "ğŸ›¡ï¸ ë¬´í•œ ë°©ì–´ (ë°ë¯¸ì§€ ë°˜ê°)"; } },
        { name: "ì¹´ë©œë ˆì˜¨", hp: 80, attr: "ê¸°ë§Œ", 
          ai: (b) => { 
              const attrs = ["í˜ëª…ë‹¨", "ê¸°ë§Œ", "ì‹­ë‹¤êµ¬", "ë…¸ë©€"];
              b.attr = attrs[Math.floor(Math.random()*4)];
              return `ğŸŒˆ ì†ì„± ë³€ê²½: ${b.attr}`; 
          }, changeGimmick: true },
        { name: "í­ì£¼ ê¸°ê´€ì°¨", hp: 120, attr: "í˜ëª…ë‹¨", 
          ai: (b) => { b.dmg = 15; return `ğŸ”¥ ëŒì§„ (15 DMG)`; } }
        // ... ì—¬ê¸°ì— 30ë§ˆë¦¬ê¹Œì§€ ì‰½ê²Œ ì¶”ê°€ ê°€ëŠ¥
    ];

    const CARD_DATA = [
        { name: "í˜ëª…íƒ€", cost: 1, atk: 10, attr: "í˜ëª…ë‹¨", desc: "[íˆ¬ì§€] ì €ì²´ë ¥ ì‹œ ê°•í™”" },
        { name: "ê¸°ë§Œì°¸", cost: 1, atk: 8, attr: "ê¸°ë§Œ", desc: "[êµë€] ì½”ìŠ¤íŠ¸ ì¦ê°€" },
        { name: "ë•ë ¥í­ë°œ", cost: 1, atk: 9, attr: "ì‹­ë‹¤êµ¬", desc: "[ëª°ì…] ì—°ì† ë“œë¡œìš°" },
        { name: "ì •ì„ì°Œë¥´ê¸°", cost: 2, atk: 18, attr: "ë…¸ë©€", desc: "[ì •ì„] ë†’ì€ ê¸°ë³¸ í”¼í•´" }
    ];

    let p = { hp: 50, maxHp: 50, eng: 3, deck: [], hand: [], grave: [], node: 1 };
    let currentBoss = null;

    function initGame() {
        // ìµœì´ˆ 10ì¥ìœ¼ë¡œ ì‹œì‘
        for(let i=0; i<10; i++) p.deck.push({...CARD_DATA[Math.floor(Math.random()*4)]});
        spawnBoss();
    }

    function spawnBoss() {
        const data = BOSS_POOL[Math.floor(Math.random() * BOSS_POOL.length)];
        currentBoss = { ...data, curHp: data.hp, defending: false, dmg: 0 };
        p.eng = 3;
        p.hand = [];
        draw(5);
        nextIntent();
        updateUI();
    }

    function nextIntent() {
        currentBoss.defending = false;
        currentBoss.dmg = 0;
        const msg = currentBoss.ai(currentBoss);
        document.getElementById('boss-intent').innerText = msg;
    }

    function draw(n) {
        for(let i=0; i<n; i++) {
            if(p.deck.length === 0 && p.grave.length > 0) {
                p.deck = [...p.grave].sort(() => Math.random() - 0.5);
                p.grave = [];
            }
            if(p.hand.length < 10 && p.deck.length > 0) p.hand.push(p.deck.pop());
        }
        renderHand();
    }

    // 2. ëª¨ë°”ì¼/PC í†µí•© ë“œë˜ê·¸ ë¡œì§ (Touch Event ì¶”ê°€)
    function renderHand() {
        const wrap = document.getElementById('hand-wrapper');
        wrap.innerHTML = '';
        p.hand.forEach((c, i) => {
            const div = document.createElement('div');
            div.className = 'card';
            div.style.borderColor = `var(--${c.attr})`;
            div.innerHTML = `<div class="card-cost">${c.cost}</div><div class="card-desc"><b>${c.name}</b><br>${c.desc}</div>`;
            
            const startHandler = (e) => {
                const startY = e.touches ? e.touches[0].clientY : e.clientY;
                const moveHandler = (me) => {
                    const moveY = me.touches ? me.touches[0].clientY : me.clientY;
                    const dy = moveY - startY;
                    if(dy < 0) div.style.transform = `translateY(${dy}px)`;
                };
                const endHandler = (ee) => {
                    const endY = ee.changedTouches ? ee.changedTouches[0].clientY : ee.clientY;
                    if(startY - endY > 120) useCard(i, div);
                    else div.style.transform = '';
                    window.removeEventListener(e.type === 'touchstart' ? 'touchmove' : 'mousemove', moveHandler);
                    window.removeEventListener(e.type === 'touchstart' ? 'touchend' : 'mouseup', endHandler);
                };
                window.addEventListener(e.type === 'touchstart' ? 'touchmove' : 'mousemove', moveHandler);
                window.addEventListener(e.type === 'touchstart' ? 'touchend' : 'mouseup', endHandler);
            };

            div.addEventListener('mousedown', startHandler);
            div.addEventListener('touchstart', startHandler);
            wrap.appendChild(div);
        });
    }

    function useCard(idx, el) {
        const card = p.hand[idx];
        if(p.eng < card.cost) { el.style.transform = ''; return; }

        p.eng -= card.cost;
        let finalDmg = card.atk;
        
        // ìƒì„± ë¡œì§ (ìƒëµ ì—†ì´ ìœ ì§€)
        if(currentBoss.defending) finalDmg = Math.floor(finalDmg / 2);
        
        currentBoss.curHp -= finalDmg;
        el.classList.add('throwing');
        
        setTimeout(() => {
            p.grave.push(p.hand.splice(idx, 1)[0]);
            if(currentBoss.curHp <= 0) { alert("ë³´ìŠ¤ ì²˜ì¹˜!"); p.node++; spawnBoss(); }
            else { renderHand(); updateUI(); }
        }, 300);
    }

    function updateUI() {
        document.getElementById('p-hp-fill').style.width = (p.hp / p.maxHp * 100) + "%";
        document.getElementById('e-hp-fill').style.width = (currentBoss.curHp / currentBoss.hp * 100) + "%";
        document.getElementById('energy-ui').innerText = `âš¡ ${p.eng} / 3`;
        document.getElementById('boss-attr').innerText = currentBoss.attr;
        document.getElementById('boss-attr').style.color = `var(--${currentBoss.attr})`;
        document.getElementById('stage-info').innerText = `NODE: ${p.node}`;
    }

    initGame();
</script>
</body>
</html>
