<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roguelike Card Battle Pro</title>
    <style>
        :root {
            --ex-color: #ff00ff; --ssr-color: #ffcc00; --sr-color: #a335ee;
            --r-color: #0070dd; --basic-color: #ffffff;
        }

        body {
            background: radial-gradient(circle, #2c3e50, #000000);
            color: white; margin: 0; height: 100vh; overflow: hidden;
            font-family: 'apple sd gothic neo', sans-serif;
        }

        /* --- ìƒë‹¨: ì  ì •ë³´ --- */
        #enemy-area {
            height: 50vh; display: flex; flex-direction: column;
            align-items: center; justify-content: center; position: relative;
        }

        #enemy-sprite {
            width: 200px; height: 280px;
            background: url('images/EX_ì˜¤ë¦¬ì§€ë„.webp') center/cover;
            border: 4px solid #ff4d4d; border-radius: 15px;
            box-shadow: 0 0 30px rgba(255, 77, 77, 0.5);
            transition: transform 0.1s; /* í”¼ê²© ì• ë‹ˆë©”ì´ì…˜ìš© */
        }

        .hp-container {
            width: 300px; height: 25px; background: #444;
            border-radius: 15px; margin-top: 20px; overflow: hidden; border: 2px solid #fff;
        }
        #enemy-hp-bar {
            width: 100%; height: 100%; background: linear-gradient(to right, #ff4b2b, #ff416c);
            transition: width 0.3s ease;
        }

        /* --- ì¤‘ì•™: ì•Œë¦¼ ë° ìƒíƒœ --- */
        #status-bar {
            text-align: center; font-size: 1.5rem; font-weight: bold;
            text-shadow: 2px 2px 4px #000;
        }

        /* --- í•˜ë‹¨: í”Œë ˆì´ì–´ ì†íŒ¨ --- */
        #hand {
            position: fixed; bottom: -20px; left: 50%;
            transform: translateX(-50%); display: flex;
            justify-content: center; align-items: flex-end;
            width: 100%; height: 250px; padding-bottom: 50px;
        }

        .card-wrapper {
            transition: transform 0.3s ease; margin: 0 -15px;
        }

        .card {
            width: 140px; height: 200px; background-color: #333;
            background-size: cover; background-position: center;
            border: 3px solid var(--basic-color); border-radius: 12px;
            position: relative; cursor: grab; touch-action: none;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        /* ë“±ê¸‰ë³„ ìƒ‰ìƒ */
        .card[data-grade="EX"] { border-color: var(--ex-color); box-shadow: 0 0 15px var(--ex-color); }
        .card[data-grade="SSR"] { border-color: var(--ssr-color); }
        .card[data-grade="SR"] { border-color: var(--sr-color); }

        .card-cost {
            position: absolute; top: -10px; left: -10px;
            background: #3498db; width: 30px; height: 30px;
            border-radius: 50%; display: flex; justify-content: center;
            align-items: center; font-weight: bold; border: 2px solid white;
        }

        .card-info {
            position: absolute; bottom: 0; width: 100%;
            background: rgba(0,0,0,0.8); padding: 8px; box-sizing: border-box;
            font-size: 10px; border-bottom-left-radius: 9px; border-bottom-right-radius: 9px;
        }

        /* íˆ¬ì²™ ë° í”¼ê²© íš¨ê³¼ */
        .card.thrown {
            transition: all 0.4s ease-in;
            transform: translateY(-100vh) scale(0) rotate(30deg) !important;
            opacity: 0;
        }

        .shake { animation: shake 0.2s; }
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            100% { transform: translateX(0); }
        }
    </style>
</head>
<body>

<div id="enemy-area">
    <div id="enemy-sprite"></div>
    <div class="hp-container">
        <div id="enemy-hp-bar"></div>
    </div>
    <div id="status-bar">ğŸ‘¾ ì  ì²´ë ¥: 100 | âš¡ ì—ë„ˆì§€: 3/3</div>
</div>

<div id="hand"></div>

<script>
    const ROGUELIKE_CARD_DB = {
        "EX_ì˜¤ë¦¬ì§€ë„.webp": { name: "ì˜¤ë¦¬ì§€ë„", atk: 20, cost: 2, desc: "ì²´ë ¥ 50% ì´í•˜ ë°ë¯¸ì§€ 2ë°°." },
        "EX_í˜ëª…ë‹¨ì •ëª¨.webp": { name: "í˜ëª…ë‹¨ì •ëª¨", atk: 12, cost: 1, desc: "ì†íŒ¨ í˜ëª…ë‹¨ë‹¹ ë°ë¯¸ì§€ +4." },
        "SSR_1ì°¨í˜ëª…ë‹¨.webp": { name: "1ì°¨í˜ëª…ë‹¨", atk: 15, cost: 2, desc: "ë‚´ ì²´ë ¥ì„ 5 ê¹ê³  ì „ì²´ 15ë€." },
        "SSR_157ë£©.webp": { name: "157ë£©", atk: 4, cost: 1, desc: "3ì¥ ì‚¬ìš© ì‹œ 2ì¥ ë“œë¡œìš°." },
        "SR_ë¹ˆí”¼.webp": { name: "ë¹ˆí”¼", atk: 7, cost: 1, desc: "50% í™•ë¥  íšŒí”¼." },
        "SR_ë¹ˆë£¨í† .webp": { name: "ë¹ˆë£¨í† ", atk: 4, cost: 1, desc: "ë™ì¼ ì¹´ë“œ 1ì¥ ìƒì„±." },
        "R_í¸ê³ .webp": { name: "í¸ê³ ", atk: 5, cost: 1, desc: "í„´ ì¢…ë£Œ ì‹œ ë°©ì–´ë ¥ 5." }
    };

    let playerEnergy = 3;
    let enemyHP = 100;
    const maxEnemyHP = 100;

    const handContainer = document.getElementById('hand');
    const statusBar = document.getElementById('status-bar');
    const enemySprite = document.getElementById('enemy-sprite');

    // 1. ì¹´ë“œ ìƒì„± ë¡œì§
    function drawCards(count) {
        const keys = Object.keys(ROGUELIKE_CARD_DB);
        for(let i=0; i<count; i++) {
            const fileName = keys[Math.floor(Math.random() * keys.length)];
            createCardUI(fileName);
        }
    }

    function createCardUI(fileName) {
        const data = ROGUELIKE_CARD_DB[fileName];
        const grade = fileName.split('_')[0];
        
        const wrapper = document.createElement('div');
        wrapper.className = 'card-wrapper';
        
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.grade = grade;
        card.dataset.filename = fileName;
        card.style.backgroundImage = `url('images/${fileName}')`;
        card.innerHTML = `
            <div class="card-cost">${data.cost}</div>
            <div class="card-info"><b>${data.name}</b><br>${data.desc}</div>
        `;

        card.onmousedown = dragStart;
        card.ontouchstart = dragStart;

        wrapper.appendChild(card);
        handContainer.appendChild(wrapper);
    }

    // 2. ë“œë˜ê·¸ & íˆ¬ì²™ ë¡œì§
    let draggedCard = null;
    let startY = 0;

    function dragStart(e) {
        draggedCard = e.currentTarget;
        startY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
        draggedCard.style.transition = 'none';
        
        document.onmousemove = dragMove;
        document.ontouchmove = dragMove;
        document.onmouseup = dragEnd;
        document.ontouchend = dragEnd;
    }

    function dragMove(e) {
        if (!draggedCard) return;
        const currentY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;
        const deltaY = currentY - startY;
        const moveY = Math.min(deltaY, 50); // ì•„ë˜ë¡œëŠ” ì¡°ê¸ˆë§Œ
        draggedCard.style.transform = `translateY(${moveY}px) scale(1.1)`;
    }

    function dragEnd(e) {
        if (!draggedCard) return;
        const endY = e.type === 'touchend' ? e.changedTouches[0].clientY : e.clientY;
        
        // ìœ„ë¡œ 150px ì´ìƒ ë˜ì¡Œì„ ë•Œ ì‚¬ìš©
        if (startY - endY > 150) {
            useCard(draggedCard);
        } else {
            draggedCard.style.transition = 'transform 0.3s ease';
            draggedCard.style.transform = 'translateY(0) scale(1)';
        }

        document.onmousemove = null; document.onmouseup = null;
        document.ontouchmove = null; document.ontouchend = null;
        draggedCard = null;
    }

    // 3. ê²Œì„ ë¡œì§ (ì‚¬ìš© ë° ë°ë¯¸ì§€)
    function useCard(card) {
        const data = ROGUELIKE_CARD_DB[card.dataset.filename];

        if (playerEnergy < data.cost) {
            alert("ì—ë„ˆì§€ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
            card.style.transform = 'translateY(0)';
            return;
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        playerEnergy -= data.cost;
        enemyHP = Math.max(0, enemyHP - data.atk);
        
        // ë¹„ì£¼ì–¼ íš¨ê³¼
        card.classList.add('thrown');
        enemySprite.classList.add('shake');
        setTimeout(() => enemySprite.classList.remove('shake'), 200);

        updateUI();

        // ì¹´ë“œ ì œê±° ë° ë“œë¡œìš°
        setTimeout(() => {
            card.closest('.card-wrapper').remove();
            if(enemyHP <= 0) {
                alert("ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤!");
                location.reload();
            } else {
                drawCards(1); // ì¹´ë“œ ë³´ì¶©
            }
        }, 400);
    }

    function updateUI() {
        statusBar.innerText = `ğŸ‘¾ ì  ì²´ë ¥: ${enemyHP} | âš¡ ì—ë„ˆì§€: ${playerEnergy}/3`;
        document.getElementById('enemy-hp-bar').style.width = `${(enemyHP/maxEnemyHP)*100}%`;
    }

    // ì´ˆê¸°í™”
    drawCards(5);
    updateUI();
</script>
</body>
</html>
