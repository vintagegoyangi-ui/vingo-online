<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Roguelike Card Battle</title>
    <style>
        :root { --í˜ëª…ë‹¨: #ff4d4d; --ê¸°ë§Œ: #a335ee; --ì‹­ë‹¤êµ¬: #0070dd; --ë…¸ë§: #44bd32; }
        body { background: #05050a; color: white; margin: 0; height: 100vh; font-family: 'Pretendard', sans-serif; overflow: hidden; touch-action: none; }

        /* --- UI ë ˆì´ì•„ì›ƒ --- */
        #enemy-header { position: absolute; top: 3%; width: 100%; text-align: center; z-index: 5; }
        .hp-bar-large { width: 80%; max-width: 400px; height: 18px; background: #333; border: 2px solid #555; border-radius: 10px; margin: 5px auto; overflow: hidden; position: relative; }
        .hp-text { position: absolute; width: 100%; text-align: center; font-size: 10px; line-height: 18px; font-weight: bold; }

        #battle-field { height: 50vh; display: flex; align-items: center; justify-content: center; position: relative; }
        #boss-sprite { 
            width: 150px; height: 180px; border-radius: 15px; border: 3px solid #fff;
            background: #222 url('https://via.placeholder.com/150x180/222/fff?text=BOSS') center/cover;
            transition: transform 0.1s, filter 0.1s;
        }

        #player-status-line { 
            position: absolute; bottom: 36vh; width: 100%; padding: 0 15px;
            display: flex; justify-content: space-between; align-items: center; box-sizing: border-box;
        }
        .deck-info { background: rgba(255,255,255,0.1); padding: 5px 12px; border-radius: 8px; font-size: 0.9rem; border: 1px solid #444; }
        #turn-end-btn { 
            padding: 10px 18px; background: #e74c3c; color: white; border: none; 
            border-radius: 8px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 0 #c0392b;
        }

        #hand-container { 
            position: fixed; bottom: 0; width: 100%; height: 35vh; 
            background: linear-gradient(to top, #111, #000); border-top: 1px solid #333;
            display: flex; align-items: center; padding: 0 10px; overflow-x: auto;
        }

        /* --- ì¹´ë“œ ë””ìì¸ --- */
        .card { 
            width: 120px; height: 175px; flex-shrink: 0; margin-right: 12px;
            background: #1a1a1a; border: 3px solid #fff; border-radius: 12px;
            position: relative; transition: transform 0.1s; overflow: hidden;
        }
        .card-img { width: 100%; height: 55%; background-size: cover; background-position: center; border-bottom: 2px solid #333; }
        .card-cost { position: absolute; top: 5px; left: 5px; width: 24px; height: 24px; background: #007bff; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 14px; border: 1.5px solid #fff; z-index: 3; }
        .card-attr-icon { position: absolute; top: 5px; right: 5px; font-size: 14px; z-index: 3; }
        .card-info { padding: 6px; font-size: 0.75rem; background: #1a1a1a; }
        .card-name { font-weight: bold; font-size: 0.85rem; display: block; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card-stats { color: #ffeb3b; font-weight: bold; font-size: 0.7rem; }
        .card-desc { font-size: 0.62rem; color: #ccc; display: block; margin-top: 4px; line-height: 1.2; height: 35px; overflow: hidden; }

        .hp-fill { height: 100%; transition: width 0.3s; }
        .throwing { transition: 0.4s ease-in !important; transform: translateY(-800px) scale(0.2) !important; opacity: 0; }
    </style>
</head>
<body>

<script src="vts_card_db.js"></script>

<div id="enemy-header">
    <div id="boss-intent">ì¤€ë¹„...</div>
    <div class="hp-bar-large">
        <div id="e-hp-fill" class="hp-fill" style="background: #ff4d4d; width: 100%;"></div>
        <div class="hp-text"><span id="e-hp-val">100</span> / 100</div>
    </div>
    <div id="boss-name" style="font-weight:bold;">BOSS</div>
</div>

<div id="battle-field">
    <div id="boss-sprite"></div>
</div>

<div id="player-status-line">
    <div class="deck-info">ğŸ—‚ï¸ <span id="deck-count">0</span></div>
    <div style="flex: 1; margin: 0 15px;">
        <div style="font-size: 0.75rem; margin-bottom: 4px; display: flex; justify-content: space-between;">
            <span>PLAYER HP</span> <span id="p-energy" style="color:#00d2ff; font-weight:bold;">âš¡ 3 / 3</span>
        </div>
        <div class="hp-bar-large" style="width: 100%; height: 12px; margin: 0;">
            <div id="p-hp-fill" class="hp-fill" style="background: #2ecc71; width: 100%;"></div>
            <div class="hp-text"><span id="p-hp-val">50</span> / 50</div>
        </div>
    </div>
    <div class="deck-info">ğŸ’€ <span id="grave-count">0</span></div>
    <button id="turn-end-btn" onclick="game.endTurn()">TURN END</button>
</div>

<div id="hand-container"></div>

<script>
    class CardGame {
        constructor() {
            this.pHP = 50; this.maxPHP = 50; this.energy = 3;
            this.deck = []; this.hand = []; this.grave = [];
            this.boss = { name: "í…ŒìŠ¤íŠ¸ ë³´ìŠ¤", hp: 100, curHp: 100 };
            
            // ë°ì´í„° í™•ì¸ (card_db.js ë¡œë“œ ì—¬ë¶€)
            if (typeof ROGUELIKE_CARD_DB === 'undefined') {
                console.error("card_db.jsë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê²½ë¡œë¥¼ í™•ì¸í•˜ì„¸ìš”.");
                return;
            }
        }

        init() {
            // ì™¸ë¶€ DBì—ì„œ ì¹´ë“œ 10ì¥ì„ ê°€ì ¸ì™€ ë± ìƒì„±
            const keys = Object.keys(ROGUELIKE_CARD_DB);
            for(let i=0; i<10; i++) {
                const randomKey = keys[Math.floor(Math.random() * keys.length)];
                // íŒŒì¼ëª…ì„ ì´ë¯¸ì§€ ê²½ë¡œë¡œ í™œìš©í•˜ê¸° ìœ„í•´ fileName ì†ì„± ì¶”ê°€
                this.deck.push({ ...ROGUELIKE_CARD_DB[randomKey], fileName: randomKey });
            }
            this.draw(5);
            this.updateUI();
        }

        draw(n) {
            for(let i=0; i<n; i++) {
                if(this.deck.length === 0 && this.grave.length > 0) {
                    this.deck = [...this.grave].sort(() => Math.random() - 0.5);
                    this.grave = [];
                }
                if(this.hand.length < 10 && this.deck.length > 0) this.hand.push(this.deck.pop());
            }
            this.renderHand();
            this.updateUI();
        }

        renderHand() {
            const container = document.getElementById('hand-container');
            container.innerHTML = '';
            this.hand.forEach((card, idx) => {
                const el = document.createElement('div');
                el.className = 'card';
                el.style.borderColor = `var(--${card.attr})`;
                // images/ ê²½ë¡œ ì—°ë™
                el.innerHTML = `
                    <div class="card-cost">${card.cost}</div>
                    <div class="card-attr-icon">${card.icon}</div>
                    <div class="card-img" style="background-image: url('images/${card.fileName}')"></div>
                    <div class="card-info">
                        <span class="card-name">${card.name}</span>
                        <span class="card-stats">âš”ï¸ ${card.atk} | ğŸ›¡ï¸ ${card.def}</span>
                        <span class="card-desc">${card.desc}</span>
                    </div>
                `;
                this.addDragLogic(el, idx);
                container.appendChild(el);
            });
        }

        addDragLogic(el, idx) {
            let startY;
            const startHandler = (e) => {
                startY = e.touches ? e.touches[0].clientY : e.clientY;
                el.style.zIndex = "100";
            };
            const moveHandler = (e) => {
                if(!startY) return;
                const nowY = e.touches ? e.touches[0].clientY : e.clientY;
                const dy = nowY - startY;
                if(dy < 0) el.style.transform = `translateY(${dy}px) scale(1.05)`;
            };
            const endHandler = (e) => {
                const endY = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
                if(startY - endY > 150) this.playCard(idx, el);
                else { el.style.transform = ""; el.style.zIndex = "1"; }
                startY = null;
            };
            el.addEventListener('mousedown', startHandler);
            window.addEventListener('mousemove', moveHandler);
            window.addEventListener('mouseup', endHandler);
            el.addEventListener('touchstart', startHandler);
            window.addEventListener('touchmove', moveHandler);
            window.addEventListener('touchend', endHandler);
        }

        playCard(idx, el) {
            const card = this.hand[idx];
            if(this.energy < card.cost) { el.style.transform = ""; return; }

            this.energy -= card.cost;
            this.boss.curHp -= card.atk;
            
            el.classList.add('throwing');
            setTimeout(() => {
                this.grave.push(this.hand.splice(idx, 1)[0]);
                this.renderHand(); 
                this.updateUI();
            }, 300);
        }

        endTurn() {
            this.pHP -= 10;
            this.energy = 3;
            this.draw(2);
            this.updateUI();
        }

        updateUI() {
            document.getElementById('p-hp-fill').style.width = (this.pHP / this.maxPHP * 100) + "%";
            document.getElementById('p-hp-val').innerText = this.pHP;
            document.getElementById('e-hp-fill').style.width = (this.boss.curHp / this.boss.hp * 100) + "%";
            document.getElementById('e-hp-val').innerText = Math.max(0, this.boss.curHp);
            document.getElementById('p-energy').innerText = `âš¡ ${this.energy} / 3`;
            document.getElementById('deck-count').innerText = this.deck.length;
            document.getElementById('grave-count').innerText = this.grave.length;
        }
    }

    const game = new CardGame();
    game.init();
</script>
</body>
</html>
