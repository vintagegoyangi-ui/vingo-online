==================================================
[가챠 연동형 덱 빌딩 로그라이크 - 통합 게임 로직 설계서]
버전: 2026.02.02 (최종 밸런스 조정본)
==================================================

1. 시스템 초기화 (Initialization)
--------------------------------------------------
- 덱 빌딩: 유저 가챠 카드(N) + 부족분 공용 카드(15-N) = 총 15장 세팅.
- 전투 초기화: Draw Pile(15장 섞음), Discard Pile(0), 초기 손패 3장 드로우.
- 기본 스탯: HP 50 / Energy 3 / Shield 0.

2. 턴 매커니즘 (Turn Logic)
--------------------------------------------------
- 시작: 에너지 3 회복, 카드 2장 드로우.
- 제한: 핸드 최대 10장 (초과 시 소멸이 아닌 Discard Pile로 이동).
- 에너지: 사용하지 않은 에너지는 소멸 (단, 특정 유물 보유 시 이월 가능).
- 덱 순환: Draw Pile이 비면 Discard Pile을 섞어 즉시 보충.

3. 데미지 및 방어 연산 (Calculations)
--------------------------------------------------
[공식] 최종 데미지 = (기본 공격력 + 고정 추가뎀) * 상성 배율 * 기믹 배율

(1) 상성 배율 (Attribute Multiplier)
    - 우세 상성: x1.5 (혁명단->기만, 기만->노말, 십다구->노말 등)
    - 노말 전용 카운터: x2.0 (노말 -> 혁명단 타격 시)
    - 열세 상성: x0.8
    - 동일 속성: x1.0

(2) 방어 및 회피 (Defense & Evade)
    - Shield: 받은 데미지를 수치만큼 차감.
    - Evade(교란): 성공 시 데미지 0 (스택 전체 소모), 실패 시 데미지 받음 (스택 유지).
    - 회피 확률 캡: 최대 75% 제한.

4. 속성별 심화 기믹 (Advanced Mechanics)
--------------------------------------------------
- [혁명단 - 투지]: 현재 HP가 최대 HP의 40% 이하일 때 상시 발동. 데미지 x1.5배 증가.
- [기만 - 교란]: 카드 1장 사용 시 스택 +1. 회피율 = (스택 * 5%).
- [십다구 - 몰입]: 한 턴에 카드 3장 사용 직후 발동. 4장째부터 Cost -1, 데미지 +2.
- [노말 - 정석]: 턴 종료 시 사라지는 Shield를 100% 다음 턴으로 이월 보존.

5. 카운터 및 특수 효과 (Counters)
--------------------------------------------------
- [관통]: 방어력을 무시하고 HP에 직접 데미지 (노말 카운터).
- [강타]: 적의 교란 스택을 0으로 초기화 + 1턴간 회피 불가 (기만 카운터).
- [평정]: 적의 투지/몰입 상태를 즉시 해제 및 1턴간 발동 금지 (혁명단/십다구 카운터).
- [과부하]: 적에게 다음 턴 드로우 -1 페널티 부여 (연쇄 콤보 방해).

6. 월드 맵 및 스테이지 구조 (World Map)
--------------------------------------------------
- 구성: 총 10 Stage (1층/10층 고정, 2~9층 분기형 노드).
- 진행: 유저가 2~3개의 갈림길 중 하나를 선택하여 전진.
- 노드 종류:
    * 일반 전투(⚔️): 일반 보상.
    * 보스 전투(☠️): 상급 보상. 보스의 '속성 아이콘'을 미리 보여주어 유저가 선택 가능.
    * 상점(💰): 카드 구매/삭제, 최대 에너지 증가 유물 판매.
    * 휴식(💤): HP 30% 회복 혹은 카드 1장 강화(+30% 스탯).
    * 이벤트(?): 함정(HP 감소), 보물상자, 무작위 카드 교환.
- 난이도 Phase:
    * Phase 1 (1-3층): 기초 적.
    * Phase 2 (4-7층): 엘리트 적, 상태이상 기믹 사용.
    * Phase 3 (8-10층): SSR등급 보스(30종 중 랜덤) 및 복합 기믹 적.

7. 보상 및 성장 (Growth)
--------------------------------------------------
- 전투 승리 보상: 
    1) 카드 보상 (랜덤 카드 3장 중 1장 선택 추가).
    2) 카드 강화 (보유 카드 중 1장 스탯 강화).
    3) 카드 삭제 (덱 압축을 위해 필요 없는 카드 제거).
- 저장: Firebase를 통해 매 층 클리어 시 덱 상태 및 잔여 HP 실시간 동기화.



*데미지 계산기 함수(calculateBattle)**와 상성 체크 로직을 실제 JavaScript 코드로 구현해 드릴까요? 아니면 맵의 갈림길 노드 데이터를 생성하는 로직을 짜 드릴까요?
